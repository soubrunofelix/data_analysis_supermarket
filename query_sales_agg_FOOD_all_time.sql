-- ALL Infos agg >>>> between '2019-01-01' and '2021-11-30'

SELECT FOOD_BEVERAGES,
SUM(Qtde) as Amount,
SUM(ValUni) as Unit_Price,
--SUM(ValTot) as Total_Price,
Unidade,
Descricao,
DataEmissao
FROM

(SELECT CASE 
WHEN NCM IN (10063029,10063029,10062020,10063011,10063019,10062010,10063021) THEN 'RICE' 
WHEN NCM IN (7133590,20055100,7133319,20055900,7133329,7133399) THEN 'BEAN' 
WHEN NCM IN (9012100,9030010,21011190,9012200,21013000,21011110,12119090,21011200,9030090) THEN 'COFFE&TEA' 
WHEN NCM IN (17011400,17011300,17019900) THEN 'SUGAR'
--WHEN NCM IN (25010090,25010011,25010020) THEN 'SALT'
WHEN NCM IN (8109014,8109090,8052100,8107000,8031000,8071900,8109011,8094000,8029000,8109015,20098913,
	20086010,8093010,8093020,8071100,8101000,8061000,8044000,8083000,8105000,8119000,8011100,8011900,
	8045010,8043000,8045020,8109000,8055000,8081000,8039000,8051000) THEN 'FRUIT'
--WHEN NCM IN (15171000,4031000,4061090,4039000,19011010,4022120,4100000,4015029,17019100,21050010,
--	4049000,4015021,15179090,4051000,4029900) THEN 'MILK_PROD'
--WHEN NCM IN (4061010,4069010,4064000,4063000,4069090,4062000,4069020,4069030) THEN 'CHEESE'
WHEN NCM IN (10085090,8135000,12079990,19042000,21061000,4090000,12040090,11041200) THEN 'NATURAL'
--WHEN NCM IN (21032010,20021000,7096000,20029090) THEN 'TOMATO_SAUCE'
--WHEN NCM IN (19021900,19021100) THEN 'PASTA'
WHEN NCM IN (20081100,20071000,18063220,21069050,19049000,17041000,17049090,18050000,20079990,
	17049020,17049010,18063110,19019020,20052000,18063210,18061000,18069000,19041000) THEN 'CANDY'
WHEN NCM IN (2072700,2072500,34051000,2071200,2071100,16023220,16023100,2071300,2071400) THEN 'CHICKEN_MEAT'
WHEN NCM IN (16041310,3048100,3055310,3056990,3055100,3032300,3053290,3036300,3047500,3047100,3038990,
	3035200,3038114,3049300,3048990,3038321,3049900,3049400,3056910,3038190,3046100,3038910,16042090,3047400,
	3038329,3046900,16042030,16041410,3035300,3035400,16042010) THEN 'FISH_MEAT'
WHEN NCM IN (2013000,16025000,2023000,2102000,2062990,2062200) THEN 'COW_MEAT'
WHEN NCM IN (16024100,2031900,2101100,15011000,2031100,2032900,2101900,2032200,2101200,16024900,16010000) THEN 'PIG_MEAT'

WHEN NCM IN (22030000) THEN 'BEER'
--WHEN NCM IN (2204101022042211,22041090,22042911,22043000,22060010,22042100) THEN 'WINE'
--WHEN NCM IN (2208200022085000,22083010,22087000,22083020,22089000,22051000,22060090,22084000,22086000) THEN 'DISTILLED'


END AS 'FOOD_BEVERAGES',
 
Qtde,
ValUni,
--ValTot,
Unidade,
Descricao,
DataEmissao
	
FROM RFDSATItem TABELA01
INNER JOIN (SELECT ChaveAcessoNFE, DataEmissao FROM  RFDSAT WHERE DataEmissao between '2019-01-01' and '2021-11-30') TABELA02
ON TABELA01.ChaveAcessoNFE=TABELA02.ChaveAcessoNFE) TAB_A

WHERE FOOD_BEVERAGES is not null
GROUP BY FOOD_BEVERAGES,Unidade,Descricao, DataEmissao;